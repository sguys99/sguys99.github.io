<!DOCTYPE html>
<html>
<head>

    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- dynamically fixing the title for tag/author pages -->



    <title>custom dataset으로 YOLOv5 학습하기1</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.edited.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />

    <!--custom.css-->
    <link rel="stylesheet" type="text/css" href="/assets/built/custom.css" />

    <!-Font Awesome-->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <!--웹폰트 추가-->
    <link rel="stylesheet" href="https://fonts.googleapis.com/earlyaccess/nanumgothic.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300&display=swap" />

    <!--syntax.css 추가-->
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />


    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!--[if IE]>
        <style>
            p, ol, ul{
                width: 100%;
            }
            blockquote{
                width: 100%;
            }
        </style>
    <![endif]-->
    
    <!-- This tag outputs SEO meta+structured data and other important settings -->
    <meta name="description" content="Data science, Machine learning, and Automatic control" />
    <link rel="shortcut icon" href="https://sguys99.github.io//assets/images/logo.png" type="image/png" />
    <link rel="canonical" href="https://sguys99.github.io//ds01" />
    <meta name="referrer" content="no-referrer-when-downgrade" />

     <!--title below is coming from _includes/dynamic_title-->
    <meta property="og:site_name" content="Happy Plant" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="custom dataset으로 YOLOv5 학습하기1" />
    <meta property="og:description" content="이 포스트는 여러 절로 구성되어 있습니다. YOLO5 #1 - custom dataset으로 학습하기 YOLO5 #2 - 학습 파라미터 설정하기 YOLO(You Only Look Once)는 널리 쓰이는 object detection 알고리즘이다. 최근에는 YOLOv5 까지 출시되었다. 여기서는 공식 github 계정에 업로드된 YOLOv5 코드로 custom dataset을 학습하는 방법에 대하여 설명한다. google colab 환경에서 진행되었다. 1. 데이터셋" />
    <meta property="og:url" content="https://sguys99.github.io//ds01" />
    <meta property="og:image" content="https://sguys99.github.io//assets/images/2021-12-21-ds1/ds01.00.jpg" />
    <meta property="article:publisher" content="https://www.facebook.com/dbrhkdaud" />
    <meta property="article:author" content="https://www.facebook.com/dbrhkdaud" />
    <meta property="article:published_time" content="2021-12-21T13:30:00+00:00" />
    <meta property="article:modified_time" content="2021-12-21T13:30:00+00:00" />
    <meta property="article:tag" content="Data-science" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="custom dataset으로 YOLOv5 학습하기1" />
    <meta name="twitter:description" content="이 포스트는 여러 절로 구성되어 있습니다. YOLO5 #1 - custom dataset으로 학습하기 YOLO5 #2 - 학습 파라미터 설정하기 YOLO(You Only Look Once)는 널리 쓰이는 object detection 알고리즘이다. 최근에는 YOLOv5 까지 출시되었다. 여기서는 공식 github 계정에 업로드된 YOLOv5 코드로 custom dataset을 학습하는 방법에 대하여 설명한다. google colab 환경에서 진행되었다. 1. 데이터셋" />
    <meta name="twitter:url" content="https://sguys99.github.io//" />
    <meta name="twitter:image" content="https://sguys99.github.io//assets/images/2021-12-21-ds1/ds01.00.jpg" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Happy Plant" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Data-science" />
    <meta name="twitter:site" content="@sguys99" />
    <meta name="twitter:creator" content="@sguys99" />
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="933" />

    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
        "@type": "Organization",
        "name": "Happy Plant",
        "logo": "https://sguys99.github.io//"
    },
    "url": "https://sguys99.github.io//ds01",
    "image": {
        "@type": "ImageObject",
        "url": "https://sguys99.github.io//assets/images/2021-12-21-ds1/ds01.00.jpg",
        "width": 2000,
        "height": 666
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://sguys99.github.io//ds01"
    },
    "description": "이 포스트는 여러 절로 구성되어 있습니다. YOLO5 #1 - custom dataset으로 학습하기 YOLO5 #2 - 학습 파라미터 설정하기 YOLO(You Only Look Once)는 널리 쓰이는 object detection 알고리즘이다. 최근에는 YOLOv5 까지 출시되었다. 여기서는 공식 github 계정에 업로드된 YOLOv5 코드로 custom dataset을 학습하는 방법에 대하여 설명한다. google colab 환경에서 진행되었다. 1. 데이터셋"
}
    </script>

    <!-- <script type="text/javascript" src="https://demo.ghost.io/public/ghost-sdk.min.js?v=724281a32e"></script>
    <script type="text/javascript">
    ghost.init({
    	clientId: "ghost-frontend",
    	clientSecret: "f84a07a72b17"
    });
    </script> -->

    <meta name="generator" content="Jekyll 3.6.2" />
    <link rel="alternate" type="application/rss+xml" title="custom dataset으로 YOLOv5 학습하기1" href="/feed.xml" />


</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
        
            
                <a class="site-nav-logo" href="https://sguys99.github.io//">Happy Plant</a>
            
        
        
            <ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="/">Home</a></li>
    <li class="nav-about" role="menuitem"><a href="/about/">About</a></li>
    <li class="nav-data-science" role="menuitem"><a href="/tag/data-science/">Data Science</a></li>
    <li class="nav-algorithmic-trading" role="menuitem"><a href="/tag/algorithmic-trading/">Trading</a></li>
    <li class="nav-python" role="menuitem"><a href="/tag/it-tips/">It Tips</a></li>
    <li class="nav-diary" role="menuitem"><a href="/tag/diary/">Diary</a></li>
    <!-- 주석
    <li class="nav-goto-turtles3040" role="menuitem"><a href="https://github.com/turtles3040">turtles3040</a></li>
    -->
    <li class="nav-archive" role="menuitem">
        <a href="/archive.html">All Posts</a>
    </li>
    <li class="nav-archive" role="menuitem">
        <a href="/author_archive.html">Posts by Tag</a>
    </li>
</ul>

        
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            
                <a class="social-link social-link-fb" href="https://facebook.com/dbrhkdaud" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>
</a>
            
            
            <a class="social-link social-link-tw" href="https://www.github.com/sguys99" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-github" viewBox="0 0 16 16">
  <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"/>
</svg></a>
            
            
            <a class="social-link social-link-tw" href="https://www.linkedin.com/in/kmyu99" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1"  width="24" height="24" viewBox="0 0 24 24"><path fill="#FFFFFF" d="M21,21H17V14.25C17,13.19 15.81,12.31 14.75,12.31C13.69,12.31 13,13.19 13,14.25V21H9V9H13V11C13.66,9.93 15.36,9.24 16.5,9.24C19,9.24 21,11.28 21,13.75V21M7,21H3V9H7V21M5,3A2,2 0 0,1 7,5A2,2 0 0,1 5,7A2,2 0 0,1 3,5A2,2 0 0,1 5,3Z" /></svg></a>
            
            
                <a class="social-link social-link-tw" href="https://twitter.com/sguys99" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>
</a>
            
        </div>
        
            <a class="subscribe-button" href="#subscribe">Search</a>
        
    </div>
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full  tag-data-science post ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime="21 December 2021">21 December 2021</time>
                    
                        <span class="date-divider">/</span>
                        
                            
                               <a href='/tag/data-science/'>DATA-SCIENCE</a>
                            
                        
                    
                </section>
                <h1 class="post-full-title">custom dataset으로 YOLOv5 학습하기1</h1>
            </header>

            <!-- 포스트 위에 그림나오는 것 생략하기 위해 주석처리
            
            <figure class="post-full-image" style="background-image: url(/assets/images/2021-12-21-ds1/ds01.00.jpg)">
            </figure>
            
            포스트 위에 그림나오는 것 생략하기 위해 주석처리 -->

            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <p><span class="table-of-contents-list">이 포스트는 여러 절로 구성되어 있습니다. </span></p>
<ul class="table-of-contents-list">
    <li><a href="./ds01">YOLO5 #1 - custom dataset으로 학습하기</a></li>
    <li><a href="./ds02">YOLO5 #2 - 학습 파라미터 설정하기</a></li>
</ul>

<p>YOLO(You Only Look Once)는 널리 쓰이는 object detection 알고리즘이다. 최근에는 YOLOv5 까지 출시되었다. 여기서는 공식 github 계정에 업로드된 YOLOv5 코드로 custom dataset을 학습하는 방법에 대하여 설명한다. google colab 환경에서 진행되었다.</p>

<h3 id="1-데이터셋-소개">1. 데이터셋 소개</h3>

<p>실습에 사용되는 데이터셋은 <code class="language-plaintext highlighter-rouge">roboflow</code>에서 제공되는 <code class="language-plaintext highlighter-rouge">North American Mushrooms Dataset</code>이다.<a href="https://public.roboflow.com/object-detection">[링크]</a></p>

<p><img src="assets/images/2021-12-21-ds1/ds01.01.jpg" /></p>

<p>여기서는 학습시간을 줄이기 위해서 416x416 사이즈의 이미지 51장을 다운 받았다.</p>

<p><img src="assets/images/2021-12-21-ds1/ds01.02.jpg" /></p>

<p>object detection 알고리즘 라이브러리 구현방식에 따라, 그리고 YOLO 버전 별로도 사용하는 레이블링 파일의 포맷이 다르다. <code class="language-plaintext highlighter-rouge">roboflow</code>에서는 레이블링 파일 포맷을 선택하여 다운도르 할 수 있다. 우리는 PyTorch로 구현된 공식 계정의 코드를 사용할 예정이므로 <code class="language-plaintext highlighter-rouge">YOLO v5 PyTorch</code>를 선택하고 다운로드 한다.</p>

<p><img src="assets/images/2021-12-21-ds1/ds01.03.jpg" /></p>

<p>참고로 YOLOv5 공식계정의 코드는 <code class="language-plaintext highlighter-rouge">txt</code> 포맷의 레이블링 데이터를 사용한다.
이 파일은 이미지에서 검출된 object에 대한 클래스와 bounding box 정보를 포함하고 있다. 검출 객체정보 배치는 <code class="language-plaintext highlighter-rouge">[class, x_center, y_center, width, height]</code> 형태로 되어있다. bounding box 정보는 이미지 사이즈에 의해 정규화 되어있다. 따라서 0~1 범위의 값을 가진다.</p>

<p><img src="assets/images/2021-12-21-ds1/ds01.04.jpg" /></p>

<p>편의를 위해 다운로드한 데이터 셋 압축파일의 폴더 이름을 <code class="language-plaintext highlighter-rouge">custom_dataset</code>으로 수정한다. 데이터 폴더 구성은 다음과 같다.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>custom_dataset
│
├── test/
│   ├── images/                    
│   └── labels/             
│
├── train/
│   ├── images/                
│   └── labels/               
│
├── valid/
│   ├── images/                    
│   └── labels/   
│
├── data.yaml
└── README.dataset.txt
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">data.yaml</code>파일을 메모장으로 열어보자. 데이터 셋 기본정보가 포함되어 있다. <code class="language-plaintext highlighter-rouge">우리는 *.yaml</code> 파일을 새로 만들 것이다. 어떤 식으로 구성되는지 참고만 한다.</p>

<p><img src="assets/images/2021-12-21-ds1/ds01.05.jpg" /></p>

<p><code class="language-plaintext highlighter-rouge">train</code>과 <code class="language-plaintext highlighter-rouge">val</code>은 각 데이터 셋의 경로정보이다. 그리고 nc는 class의 수(number of classes)를, names는 각 클래스의 이름이다.</p>

<h3 id="2-colab에서-환경구축하기">2. colab에서 환경구축하기</h3>

<p>google colab에 접속하고 새 노트를 생성한다. <code class="language-plaintext highlighter-rouge">런타임</code>-<code class="language-plaintext highlighter-rouge">런타임 유형 변경</code>을 선택하여, 하드웨어 가속기를 <code class="language-plaintext highlighter-rouge">GPU</code>로 설정한다.</p>

<p><img src="assets/images/2021-12-21-ds1/ds01.06.jpg" /></p>

<p>이제 colab 노트에 공식 github 계정의 파일을 다운로드하고, 필수 라이브러리를 설치하는 명령을 입력한다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">!</span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">ultralytics</span><span class="o">/</span><span class="n">yolov5</span>  <span class="c1"># yolov5 코드 clone
</span><span class="o">%</span><span class="n">cd</span> <span class="n">yolov5</span> 										  <span class="c1"># clone한 폴더로 진입
</span><span class="o">%</span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">qr</span> <span class="n">requirements</span><span class="p">.</span><span class="n">txt</span>                 <span class="c1"># 필수 라이브러리 설치
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Cloning into 'yolov5'...
remote: Enumerating objects: 10354, done.
remote: Total 10354 (delta 0), reused 0 (delta 0), pack-reused 10354
Receiving objects: 100% (10354/10354), 10.58 MiB | 23.75 MiB/s, done.
Resolving deltas: 100% (7149/7149), done.
/content/yolov5
     |████████████████████████████████| 596 kB 5.4 MB/s 
</code></pre></div></div>

<p>파일 탐색기에 yolov5 폴더가 생성되었고, 파일들이 다운로드 되어있다.</p>

<p><img src="assets/images/2021-12-21-ds1/ds01.07.jpg" /></p>

<p>이제 앞에서 다운로드한 데이터셋을 업로드 한다. 파일 탐색기의 업로드 아이콘을 클릭하여 <code class="language-plaintext highlighter-rouge">custom_dataset.zip</code> 파일을 업로드 한다.
업로드가 완료되면 탐색기에 해당 파일이 표시된다.</p>

<p><img src="assets/images/2021-12-21-ds1/ds01.08.jpg" /></p>

<p>unzip 명령으로 데이터 셋 파일의 압축을 해제한다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">!</span><span class="n">unzip</span> <span class="p">..</span><span class="o">/</span><span class="n">custom_dataset</span><span class="p">.</span><span class="nb">zip</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Archive:  ../custom_dataset.zip
  inflating: custom_dataset/data.yaml  
  inflating: custom_dataset/README.dataset.txt  
  inflating: custom_dataset/README.roboflow.txt  
   creating: custom_dataset/test/
   creating: custom_dataset/test/images/
  inflating: custom_dataset/test/images/chanterelle_02_jpg.rf.f7a48494b7393c532f641585d99a57be.jpg  
  inflating: custom_dataset/test/images/chanterelle_03_jpg.rf.580f8d787af6a8050c21c065bf016f20.jpg  
  inflating: custom_dataset/test/images/chanterelle_03_jpg.rf.cd892d2f06d228ba20d194fc360320fc.jpg  
  --- (생 략)
</code></pre></div></div>

<p>완료되면 <code class="language-plaintext highlighter-rouge">yolov5/custom_dataset/</code> 경로에 데이터 셋이 위치하게 된다. (현 작업 디렉토리가 yolov5이기 때문)</p>

<p><img src="assets/images/2021-12-21-ds1/ds01.09.jpg" /></p>

<p>마지막으로 데이터 셋 설정파일을 작성한다.</p>

<p>` yolov5/data/<code class="language-plaintext highlighter-rouge"> 폴더에 </code>custom_dataset.yaml`이라는 이름의 파일을 생성한다.</p>

<p><img src="assets/images/2021-12-21-ds1/ds01.10.jpg" /></p>

<p>여기에 다음과 같이 설정정보를 입력한다.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>path: /content/yolov5/custom_dataset  #root 디렉토리
train: train/images					  # 학습데이터 경로
val: valid/images
test: test/images

nc: 2								# 클래스 수
names: ['CoW', 'chanterelle']		# 클래스 이름
</code></pre></div></div>

<p>자세한 내용은 다음 <a href="https://github.com/ultralytics/yolov5/wiki/Train-Custom-Data">링크</a>의 <code class="language-plaintext highlighter-rouge">**1.1 Create dataset.yaml**</code> 항목을 참고하자.</p>

<p>이로써 학습을 위한 모든 준비가 완료 되었다.</p>

<h3 id="3-모델-학습하기">3. 모델 학습하기</h3>

<p>모델 학습 순서는 다음과 같다.</p>

<p><img src="assets/images/2021-12-21-ds1/ds01.11.jpg" /></p>

<p>위와 같은 일련의 과정은 <code class="language-plaintext highlighter-rouge">train.py</code>  파일 실행을 통해 가능하다. 인자로 학습 데이터 경로와 epoch 수를 입력하고 학습을 진행하자.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">!</span><span class="n">python</span> <span class="n">train</span><span class="p">.</span><span class="n">py</span> <span class="o">--</span><span class="n">data</span> <span class="s">"data/custom_dataset.yaml"</span> <span class="o">--</span><span class="n">epochs</span> <span class="mi">100</span> <span class="c1">#epoch 100회
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> Downloading https://ultralytics.com/assets/Arial.ttf to /root/.config/Ultralytics/Arial.ttf...
 train: weights=yolov5s.pt, cfg=, data=data/custom_dataset.yaml, hyp=data/hyps/hyp.scratch.yaml, epochs=100, batch_size=16, imgsz=640, '''
 
 ---(생략)
 
 Overriding model.yaml nc=80 with nc=2
 
                  from  n    params  module                                  arguments                     
   0                -1  1      3520  models.common.Conv                      [3, 32, 6, 2, 2]              
   1                -1  1     18560  models.common.Conv                      [32, 64, 3, 2]                
   2                -1  1     18816  models.common.C3                        [64, 64, 1]
   
 ---(생략)
 
 Logging results to runs/train/exp
 Starting training for 100 epochs...
 
      Epoch   gpu_mem       box       obj       cls    labels  img_size
       0/99     3.23G    0.1252   0.03226   0.02699        28       640: 100% 3/3 [00:05&lt;00:00,  1.95s/it]
                Class     Images     Labels          P          R     mAP@.5 mAP@.5:.95: 100% 1/1 [00:00&lt;00:00,  2.48it/s]
                  all          5         14    0.00695      0.311    0.00395     0.0011
       
 ---(생략)
 
 Validating runs/train/exp/weights/best.pt...
 Fusing layers... 
 Model Summary: 213 layers, 7015519 parameters, 0 gradients, 15.8 GFLOPs
                Class     Images     Labels          P          R     mAP@.5 mAP@.5:.95: 100% 1/1 [00:00&lt;00:00,  4.48it/s]
                  all          5         14       0.95      0.996      0.973      0.697
                  CoW          5          5          1      0.991      0.995      0.688
          chanterelle          5          9      0.899          1      0.951      0.706
 Results saved to runs/train/exp
</code></pre></div></div>

<p>학습이 완료되면 <code class="language-plaintext highlighter-rouge">runs/train/exp</code>경로에 학습 결과가 저장된다. 학습을 반복하면 <code class="language-plaintext highlighter-rouge">runs/train</code>경로에 exp1, 2, 3… 같은 형태로 폴더가 생성되면서 학습 결과가 기록된다.</p>

<p><img src="assets/images/2021-12-21-ds1/ds01.12.jpg" /></p>

<p>학습 결과를 다운로드 하고 싶다면 zip 명령을 압축한 뒤, 저장한다 . 예를 들어 <code class="language-plaintext highlighter-rouge">train_result.zip</code>이라는 이름으로 압축하고 싶다면 다음과 같이 입력한다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">!</span><span class="nb">zip</span> <span class="o">-</span><span class="n">r</span> <span class="n">train_result</span><span class="p">.</span><span class="nb">zip</span> <span class="o">/</span><span class="n">content</span><span class="o">/</span><span class="n">yolov5</span><span class="o">/</span><span class="n">runs</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">exp</span>
</code></pre></div></div>

<p>탐색기에 <code class="language-plaintext highlighter-rouge">train_result.zip</code>가 표시되면 정상으로 압축된 것이다.</p>

<p><img src="assets/images/2021-12-21-ds1/ds01.13.jpg" /></p>

<h3 id="4-학습한-모델-검증하기">4. 학습한 모델 검증하기</h3>

<p>이제 학습한 모델로 검증을 진행해보자. 검증순서는 앞의 학습 절차에서 <code class="language-plaintext highlighter-rouge">모델 가중치 업데이트</code> 과정이 생략된 것이다.</p>

<p><img src="assets/images/2021-12-21-ds1/ds01.14.jpg" /></p>

<p>모델 검증은 <code class="language-plaintext highlighter-rouge">val.py</code>  파일 실행을 통해 진행한다. 다양한 인자가 있지만 데이터 경로(<code class="language-plaintext highlighter-rouge">--data</code>), 모델 가중치(<code class="language-plaintext highlighter-rouge">--weights</code>) 정도만 입력해서 실행해보자. 앞에서 학습한 모델 가중치는 <code class="language-plaintext highlighter-rouge">runs/train/exp/weights/best.pt</code>에 저장되었다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">!</span><span class="n">python</span> <span class="n">val</span><span class="p">.</span><span class="n">py</span> <span class="o">--</span><span class="n">data</span> <span class="s">"data/custom_dataset.yaml"</span> <span class="o">--</span><span class="n">weights</span> <span class="s">"/content/yolov5/runs/train/exp/weights/best.pt"</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>val: data=data/custom_dataset.yaml, weights=['/content/yolov5/runs/train/exp/weights/best.pt'], batch_size=32, imgsz=640, conf_thres=0.001, iou_thres=0.6, task=val, device=, workers=8, single_cls=False, augment=False, verbose=False, save_txt=False, save_hybrid=False, save_conf=False, save_json=False, project=runs/val, name=exp, exist_ok=False, half=False, dnn=False
YOLOv5 🚀 v6.0-155-gdc54ed5 torch 1.10.0+cu111 CUDA:0 (Tesla K80, 11441MiB)

Fusing layers... 
Model Summary: 213 layers, 7015519 parameters, 0 gradients, 15.8 GFLOPs
val: Scanning '/content/yolov5/custom_dataset/valid/labels.cache' images and labels... 5 found, 0 missing, 0 empty, 0 corrupted: 100% 5/5 [00:00&lt;?, ?it/s]
               Class     Images     Labels          P          R     mAP@.5 mAP@.5:.95: 100% 1/1 [00:00&lt;00:00,  2.58it/s]
                 all          5         14      0.909      0.982      0.961      0.686
                 CoW          5          5          1      0.965      0.995      0.672
         chanterelle          5          9      0.818          1      0.926        0.7
Speed: 0.6ms pre-process, 29.3ms inference, 3.0ms NMS per image at shape (32, 3, 640, 640)
Results saved to runs/val/exp
</code></pre></div></div>

<p>검증결과는 <code class="language-plaintext highlighter-rouge">runs/val/exp</code>에 저장된다. 앞에서와 마찬가지로 다운로드 받고 싶다면 폴더를 압축하자.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">!</span><span class="nb">zip</span> <span class="o">-</span><span class="n">r</span> <span class="n">val_result</span><span class="p">.</span><span class="nb">zip</span> <span class="o">/</span><span class="n">content</span><span class="o">/</span><span class="n">yolov5</span><span class="o">/</span><span class="n">runs</span><span class="o">/</span><span class="n">val</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">exp</code> 폴더 안에는 confusion matrix, F1 curve 등 성능과 관련된 차트가 저장되어 있다.</p>

<h3 id="5-학습한-모델로-예측하기">5. 학습한 모델로 예측하기</h3>

<p>예측과정은 아래 그림과 같은 절차로 진행된다.</p>

<p><img src="assets/images/2021-12-21-ds1/ds01.15.jpg" /></p>

<p>예측 과정은 <code class="language-plaintext highlighter-rouge">detect.py</code> 파일을 사용한다. 단순 이미지 뿐만 아니라 웹캠, 비디오 파일 등에서도 실행 가능하다. <code class="language-plaintext highlighter-rouge">--source</code>인자에 다음과 같이 설정해주면 된다.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>!python detect.py --source 0  # webcam
                            img.jpg  # image
                            vid.mp4  # video
                            path/  # directory
                            path/*.jpg  # glob
                            'https://youtu.be/Zgi9g1ksQHc'  # YouTube
                            'rtsp://example.com/media.mp4'  # RTSP, RTMP, HTTP stream
</code></pre></div></div>

<p>여기서는 <code class="language-plaintext highlighter-rouge">custom_dataset/test/images</code> 경로에 있는 이미지에 대해서 object detection을 실행해본다. 인식 대상 (<code class="language-plaintext highlighter-rouge">--source</code>), 모델 가중치(<code class="language-plaintext highlighter-rouge">--weights</code>)  경로를 입력해서 실행해보자.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">!</span><span class="n">python</span> <span class="n">detect</span><span class="p">.</span><span class="n">py</span> <span class="o">--</span><span class="n">weights</span> <span class="s">"/content/yolov5/runs/train/exp/weights/best.pt"</span> <span class="o">--</span><span class="n">source</span> <span class="s">"/content/yolov5/custom_dataset/test/images"</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>detect: weights=['/content/yolov5/runs/train/exp/weights/best.pt'], source=/content/yolov5/custom_dataset/test/images, imgsz=[640, 640], conf_thres=0.25, iou_thres=0.45, max_det=1000, device=, view_img=False, save_txt=False, save_conf=False, 

---(생략)

Fusing layers... 
Model Summary: 213 layers, 7015519 parameters, 0 gradients, 15.8 GFLOPs
image 1/5 /content/yolov5/custom_dataset/test/images/chanterelle_02_jpg.rf.f7a48494b7393c532f641585d99a57be.jpg: 640x640 3 chanterelles, Done. (0.034s)
--- (생략)
</code></pre></div></div>

<p>테스트 결과는 <code class="language-plaintext highlighter-rouge">/runs/detect/exp</code> 경로에 저장된다. 결과를 다운로드 하고 싶다면 다음과 같이 압축하여 저장한다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">!</span><span class="nb">zip</span> <span class="o">-</span><span class="n">r</span> <span class="n">test_result</span><span class="p">.</span><span class="nb">zip</span> <span class="o">/</span><span class="n">content</span><span class="o">/</span><span class="n">yolov5</span><span class="o">/</span><span class="n">runs</span><span class="o">/</span><span class="n">detect</span><span class="o">/</span><span class="n">exp</span>
</code></pre></div></div>

<p>폴더를 열어보면 class와 bounding box가 표시된 detection 결과 이미지가 저장되어 있다.</p>

<p><img src="assets/images/2021-12-21-ds1/ds01.16.jpg" /></p>

                </div>
            </section>


            <!-- Email subscribe form at the bottom of the page -->
            <!-- 포스트 아래에 섭스크라이브 나오는 것 생략위해 주석처리
            
                <section class="subscribe-form">
                    <h3 class="subscribe-form-title">Subscribe to Happy Plant</h3>
                    <p>Get the latest posts delivered right to your inbox</p>
                    <span id="searchform" method="post" action="/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"  />
    <input class="location" type="hidden" name="location"  />
    <input class="referrer" type="hidden" name="referrer"  />

    <div class="form-group">
        <input class="subscribe-email" onkeyup="myFunc()"
               id="searchtext" type="text" name="searchtext"
               placeholder="Search..." />
    </div>
    <script type="text/javascript">
        function myFunc() {
            if(event.keyCode == 13) {
                var url = encodeURIComponent($("#searchtext").val());
                location.href = "/search.html?query=" + url;
            }
        }
    </script>
</span>

                </section>
            
            포스트 아래에 섭스크라이브 나오는 것 생략위해 주석처리리-->

           <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
                <!-- #author-->
                
                    
                        <section class="author-card">
                            
                                <img class="author-profile-image" src="/assets/images/love-your-data.jpg" alt="km.yu99" />
                            
                            <section class="author-card-content">
                                <h4 class="author-card-name"><a href="/author/km.yu99">Kwang Myung Yu</a></h4>
                                
                                    <p><a href="https://github.com/sguys99">github</a></p>
                                
                            </section>
                        </section>
                        <div class="post-full-footer-right">
                            <a class="author-card-button" href="/author/km.yu99">Read More</a>
                        </div>
                    
                
                <!-- /author  -->
            </footer>

            <!-- If you use Disqus comments, just uncomment this block.
            The only thing you need to change is "test-apkdzgmqhj" - which
            should be replaced with your own Disqus site-id. -->
            <!-- Disqus 사용안해서 주석처리
            
            -->

        <!-- utterance comments 추가-->
        <script src="https://utteranc.es/client.js"
                repo="sguys99/blog-comments"
                issue-term="pathname"
                theme="github-light"
                crossorigin="anonymous"
                async>
        </script>
        <!-- utterance comments 추가-->

        </article>

    </div>
</main>

<!-- Links to Previous/Next posts -->
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            
                
                
                
                
                    <article class="read-next-card"
                        
                            style="background-image: url(/assets/images/main-cover.jpg)"
                        
                    >
                        <header class="read-next-card-header">
                            <small class="read-next-card-header-sitetitle">&mdash; Happy Plant &mdash;</small>
                            
                                <h3 class="read-next-card-header-title"><a href="/tag/data-science/">Data-science</a></h3>
                            
                        </header>
                        <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
</div>
                        <div class="read-next-card-content">
                            <ul>
                                
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/ds5">MySQL server 설치하기 - ubuntu linux 편</a></li>
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/ds4">Timeseries Analysis1 - datetime 라이브러리</a></li>
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/ds3">MySQL server 설치하기 - windows편</a></li>
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                            </ul>
                        </div>
                        <footer class="read-next-card-footer">
                            <a href="/tag/data-science/">
                                
                                    See all 4 posts  →
                                
                            </a>
                        </footer>
                    </article>
                
            

            <!-- If there's a next post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/ds02">
                <div class="post-card-image" style="background-image: url(/assets/images/2021-12-21-ds1/ds01.00.jpg)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/ds02">
                <header class="post-card-header">
                    
                        
                            
                                <span class="post-card-tags">Data-science</span>
                            
                        
                    

                    <h2 class="post-card-title">custom dataset으로 YOLOv5 학습하기2</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p>이 포스트는 여러 절로 구성되어 있습니다. 

    YOLO5 #1 - custom dataset으로 학습하기
    YOLO5 #2 - 학습 파라미터 설정하기


</p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                        
                        <img class="author-profile-image" src="/assets/images/love-your-data.jpg" alt="Kwang Myung Yu" />
                        
                        <span class="post-card-author">
                            <a href="/author/km.yu99/">Kwang Myung Yu</a>
                        </span>
                    
                
                <span class="reading-time">
                    
                    
                      3 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

            <!-- If there's a previous post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/trading2">
                <div class="post-card-image" style="background-image: url(/assets/images/2021-12-20-trading/tr01.01.00.jpg)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/trading2">
                <header class="post-card-header">
                    
                        
                            
                                <span class="post-card-tags">Algorithmic-trading</span>
                            
                        
                    

                    <h2 class="post-card-title">KRX에서 종목코드 가져오기2</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p>한국거래소(KRX)에서 증권과 관련된 데이터와 통계정보를 제공하는 정보데이터시스템 웹페이지가 있다.
여기서도 상장주식의 종목코드 리스트를 가져올 수 있다.

</p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                        
                        <img class="author-profile-image" src="/assets/images/love-your-data.jpg" alt="Kwang Myung Yu" />
                        
                        <span class="post-card-author">
                            <a href="/author/km.yu99/">Kwang Myung Yu</a>
                        </span>
                    
                
                <span class="reading-time">
                    
                    
                      2 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

        </div>
    </div>
</aside>

<!-- Floating header which appears on-scroll, included from includes/floating-header.hbs -->
<div class="floating-header">
    <div class="floating-header-logo">
        <a href="https://sguys99.github.io//">
            
            <span>Happy Plant</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">custom dataset으로 YOLOv5 학습하기1</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=custom+dataset%EC%9C%BC%EB%A1%9C+YOLOv5+%ED%95%99%EC%8A%B5%ED%95%98%EA%B8%B01&amp;url=https://sguys99.github.io/ds01"
            onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>

        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https://sguys99.github.io/ds01"
            onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>

        </a>
    </div>
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>


<!-- /post -->

<!-- The #contentFor helper here will send everything inside it up to the matching #block helper found in default.hbs -->


        <!-- Previous/next page links - displayed on every page -->
        

        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="https://sguys99.github.io//">Happy Plant</a> &copy; 2022</section>
                <section class="poweredby">Published with <a href="https://jekyllrb.com/">Jekyll</a> &
                    <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a> using
                    <a href="https://github.com/jekyllt/jasper2" target="_blank" rel="noopener">Jasper2</a></section>
                <nav class="site-footer-nav">
                    <a href="/">Latest Posts</a>
                    <a href="https://facebook.com/dbrhkdaud" target="_blank" rel="noopener">Facebook</a>
                    <!--
                    <a href="https://twitter.com/sguys99" target="_blank" rel="noopener">Twitter</a>
                    -->
                    <a href="https://www.linkedin.com/in/kmyu99" target="_blank" rel="noopener">LinkedIn</a>
                    <a href="https://github.com/sguys99" target="_blank" rel="noopener">Github</a>
                </nav>
            </div>
        </footer>

    </div>

    <!-- The big email subscribe modal content -->
    
    <div id="subscribe" class="subscribe-overlay">
        <a class="subscribe-overlay-close" href="#"></a>
        <div class="subscribe-overlay-content">
            
            <h1 class="subscribe-overlay-title">Search Happy Plant</h1>
            <p class="subscribe-overlay-description">
                lunr.js를 이용한 posts 검색 </p>
            <span id="searchform" method="post" action="/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"  />
    <input class="location" type="hidden" name="location"  />
    <input class="referrer" type="hidden" name="referrer"  />

    <div class="form-group">
        <input class="subscribe-email" onkeyup="myFunc()"
               id="searchtext" type="text" name="searchtext"
               placeholder="Search..." />
    </div>
    <script type="text/javascript">
        function myFunc() {
            if(event.keyCode == 13) {
                var url = encodeURIComponent($("#searchtext").val());
                location.href = "/search.html?query=" + url;
            }
        }
    </script>
</span>

        </div>
    </div>
    

    <!-- highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.10.0/components/prism-abap.min.js"></script>
    <script>$(document).ready(function() {
      $('pre code').each(function(i, block) {
        hljs.highlightBlock(block);
      });
    });</script>

    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://demo.ghost.io/assets/js/jquery.fitvids.js?v=724281a32e"></script>


    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    


    <!-- Add Google Analytics  -->
    <!-- Google Analytics Tracking code -->
 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'G-826PCGZRG1', 'auto');
  ga('send', 'pageview');

 </script>


    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>

    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->

</body>
</html>
